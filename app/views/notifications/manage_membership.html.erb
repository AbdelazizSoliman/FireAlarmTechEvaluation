<%= form_with url: approve_supplier_notification_path(@notification), method: :post, local: true do |form| %>

  <!-- Registration Type Display (Readonly) -->
  <div class="mb-4">
    <h2 class="font-semibold">Registration Type:</h2>
    <p class="text-gray-700"><%= @supplier.registration_type.capitalize %></p>
  </div>

  <!-- Conditional Membership Assignment (Only for Evaluation Type) -->
  <% if @supplier.registration_type == "evaluation" %>
    <div class="mb-4">
      <h2 class="font-semibold">This Account is Assigned to Evaluate By:</h2>
      <%= form.select :membership_type, [["Projects", "projects"], ["Systems", "systems"]],
                      { prompt: "Select Evaluation Type" },
                      { id: "membership-type-dropdown", class: "form-select" } %>
    </div>

    <!-- Projects List -->
    <div id="projects-section" class="hidden mb-4">
      <h2 class="font-semibold">Select Projects</h2>
      <% @projects.each do |project| %>
        <%= form.check_box :project_ids, { multiple: true }, project.id, nil %>
        <%= label_tag "project_#{project.id}", project.name, class: "ml-2" %><br>
      <% end %>
    </div>

    <!-- Subsystems List -->
    <div id="subsystems-section" class="hidden mb-4">
      <h2 class="font-semibold">Select Subsystems</h2>
      <% @subsystems.each do |subsystem| %>
        <%= form.check_box :subsystem_ids, { multiple: true }, subsystem.id, nil %>
        <%= label_tag "subsystem_#{subsystem.id}", subsystem.name, class: "ml-2" %><br>
      <% end %>
    </div>

    <!-- Receive Evaluation Report (Only for Evaluation Type) -->
    <div class="mb-4">
      <h2 class="font-semibold">Receive Evaluation Report?</h2>
      <%= form.radio_button :receive_evaluation_report, "true", id: "receive_true" %>
      <%= form.label :receive_evaluation_report_true, "Yes", class: "ml-2" %>
      <%= form.radio_button :receive_evaluation_report, "false", id: "receive_false" %>
      <%= form.label :receive_evaluation_report_false, "No", class: "ml-2" %>
    </div>
  <% end %>

  <!-- Hidden field for supplier_id -->
  <%= form.hidden_field :supplier_id, value: @supplier.id %>

  <!-- Approve Supplier Button -->
  <div class="flex items-center space-x-4">
    <%= form.submit "Approve Supplier", class: "bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded" %>
  </div>
<% end %>

<!-- Reject Supplier Button -->
<%= button_to "Reject Supplier", reject_supplier_notification_path(@notification, supplier_id: @supplier.id), method: :post, data: { turbo: false }, class: "bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded mt-4" %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const membershipDropdown = document.getElementById("membership-type-dropdown");
    const projectsSection = document.getElementById("projects-section");
    const subsystemsSection = document.getElementById("subsystems-section");

    function toggleSections() {
      if (membershipDropdown && membershipDropdown.value === "projects") {
        projectsSection.classList.remove("hidden");
        subsystemsSection.classList.add("hidden");
      } else if (membershipDropdown && membershipDropdown.value === "systems") {
        subsystemsSection.classList.remove("hidden");
        projectsSection.classList.add("hidden");
      } else {
        projectsSection.classList.add("hidden");
        subsystemsSection.classList.add("hidden");
      }
    }

    // Add event listener to the dropdown if it exists
    if (membershipDropdown) {
      membershipDropdown.addEventListener("change", toggleSections);
    }

    // Trigger on page load to set the initial state
    toggleSections();
  });
</script>
